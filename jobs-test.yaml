jobs:
  - script: >
      folder('GTT')
  - script: >
      folder('GTT/DevOps-Build')
  - script: >
      folder('GTT/Build')
  - script: >
      multibranchPipelineJob("GTT/DevOps-Build/astro-devops-training")
      {
        branchSources {
          git {
            id = "astro-devops-training"
            remote("git@bitbucket.org:astrosolutions-co-th/astro-devops-training.git")
            credentialsId("pjames_bitbucket_ssh_private_key")
            includes("develop|main")
          }
        }

      multibranchPipelineJob("GTT/Build/premium-service-v2")
      {
        branchSources {
          git {
            id = "astro-devops-training"
            remote("git@bitbucket.org:astrosolutions-co-th/premium-service-v2.git")
            credentialsId("pjames_bitbucket_ssh_private_key")
            includes("development|sit|uat|production")
          }
        }

        factory
        {
            remoteJenkinsFileWorkflowBranchProjectFactory 
            {
                remoteJenkinsFile("Jenkinsfile_Common")
                localMarker("")
                matchBranches(false)
                fallbackBranch("master")
            }
        }

        configure { project ->
            def factoryNode = project / 'factory'
            factoryNode << owner(class:'org.jenkinsci.plugins.workflow.multibranch.WorkflowMultiBranchProject', reference:'../..')
        
            factoryNode << remoteJenkinsFileSCM(class:'hudson.plugins.git.GitSCM') {
                userRemoteConfigs 
                {
                    'hudson.plugins.git.UserRemoteConfig' 
                    {
                        url('git@bitbucket.org:astrosolutions-co-th/astro-gtt-jenkins-files.git')
                        credentialsId('pjames_bitbucket_ssh_private_key')
                    }
                }

                branches 
                {
                    'hudson.plugins.git.BranchSpec' 
                    {
                        name('main')
                    }
                }                    
            }
        }

        orphanedItemStrategy {
            discardOldItems {
                numToKeep(20)
            }
        }
      }